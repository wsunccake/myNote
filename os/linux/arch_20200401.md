# arch linux 2020 04 01

## download image

```bash
linux:~ # wget http://archlinux.cs.nctu.edu.tw/iso/2020.04.01/archlinux-2020.04.01-x86_64.iso
linux:~ # wget http://archlinux.cs.nctu.edu.tw/iso/2020.04.01/archlinux-2020.04.01-x86_64.iso.sig
```


---

## prepare

```bash
# partition
archiso:~ # lsblk
archiso:~ # fdisk -l /dev/sda
archiso:~ # fdisk /dev/sda

archiso:~ # mkfs.ext4 /dev/sda2
archiso:~ # mount /dev/sda2 /mnt

archiso:~ # mkswap /dev/sda1
archiso:~ # swapon /dev/sda1
archiso:~ # swapon
```


---

## install

```bash
# package
archiso:~ # vi /etc/pacman.conf
archiso:~ # vi /etc/pacman.d/mirrorlist
archiso:~ # pacstrap /mnt base linux linux-firmware grub [base-devel]

# file system
archiso:~ # genfstab -U /mnt >> /mnt/etc/fstab
archiso:~ # cat /mnt/etc/fstab
```


---

## configure

```bash
# chroot
archiso:~ # arch-chroot /mnt

# clock
arch-chroot:~ # ln -sf /usr/share/zoneinfo/Asia/Taipei /etc/localtime
arch-chroot:~ # hwclock -w

# locale
arch-chroot:~ # echo en_US.UTF-8 UTF-8 >> /etc/locale.gen
arch-chroot:~ # echo zh_TW.UTF-8 UTF-8 >> /etc/locale.gen
arch-chroot:~ # echo LANG=en_US.UTF-8 > /etc/locale.conf
arch-chroot:~ # echo KEYMAP=us /etc/vconsole.conf

# hostname
arch-chroot:~ # echo arch > /etc/hostname
arch-chroot:~ # cat > /etc/hosts << EOF
127.0.0.1   localhost
::1         localhost
127.0.1.1   <arch.domain> <arch>
EOF

# password
arch-chroot:~ # passwd

# kernel
arch-chroot:~ # mkinitcpio -P

# boot
arch-chroot:~ # grub-install /dev/sda
arch-chroot:~ # grub-mkconfig -o /boot/grub/grub.cfg

arch-chroot:~ # logout
archiso:~ # reboot
```


---

## run

### network

```bash
# for static ip
arch:~ # cat > /etc/systemd/network/20-wired.network << EOF
[Match]
Name=enp1s0

[Network]
Address=10.1.10.9/24
Gateway=10.1.10.1
DNS=10.1.10.1
EOF

# for dhcp
arch:~ # cat > /etc/systemd/network/20-wired.network << EOF
[Match]
Name=enp1s0

[Network]
DHCP=ipv4
EOF

# dns/nameserver
arch:~ # echo "nameserver 10.1.10.1" > /etc/resolv.conf

arch:~ # systemctl enable systemd-networkd --now
arch:~ # networkctl list
```


### sshd

```bash
arch:~ # pacman -S openssh
arch:~ # systemctl enable sshd --now
```

